<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="static/styles/searchlooks.css">
</head>
<body>

<div class="container">
	<div class="header">
  <input type="text" id="searchQuery" placeholder="Search for your favorites">
  <button onclick="searchSong()" class="searchbtn"><img src="static/images/search.png" class="searchimg"></button>
	</div>
   <img id="artistImage" src="" alt="i">
<div class="everything_box">
	<div id="songInfo"> The song<h3 id="artistName"></h3></div>
	<div id="songInfo"><h3 id="artistName"></h3></div>
	<div class="bubbles"></div>
        <div class="bubbles"></div>
        <div class="bubbles"></div>
        <div class="bubbles"></div>
        <div class="bubbles"></div>
        <div class="bubbles"></div>
        <div class="bubbles"></div>
        <div class="bubbles"></div>
      </div>
        <div class="footer"></div>
</div>

<script>
async function searchSong() {
  try {
    const query = document.getElementById('searchQuery').value.trim();
    if (!query) {
      console.log('Please enter a song title');
      return;
    }

    const accessToken = 'BQA3-acSVmBNRPcqy066waBx-v2Ss_lPPK7vaETQuzxvYlIc2xCdRfEc2CVRWPPtaDV379F4ZUFED5AWs573kUyMdGaRqjehcjyFS1MxLS1iuTsmZO9f38z9mNNyU9ZQ2sco04eOclogZ8TzOQdljovQdp-F2n4vXHm2Ket-uVBcA91UvFRrp54iEcOOTyfURm7y1ZbxEbZFW9lM-FGgS00';
    const searchUrl = `https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track`;

    const response = await fetch(searchUrl, {
      headers: {
        'Authorization': `Bearer ${accessToken}`
      }
    });

    if (!response.ok) {
      throw new Error('Failed to search for the song');
    }

    const data = await response.json();
    const firstTrack = data.tracks.items[0]; // Get the first track from the search results

    if (!firstTrack) {
      console.log('Song not found');
      return;
    }

	function artistNameHTML() { 
		const getName = `
			<div class="musicInfo"><p class="artistName">${firstTrack.artists[0].name}</p>
			<p class="songTitle"> - ${firstTrack.name}</p></div>`;

	return getName;
	}

	  function artistImageHTML() {
      		if (firstTrack.artists[0].images) {
        		return `<img src="${firstTrack.artists[0].images[0].url}" alt="${firstTrack.artists[0].name}" class="artistImage">`;
      } else {
        return ''; // Return empty string if no image available
      }
    }


    const artistImagesHTML = artistImageHTML();
    const artistHTML = artistNameHTML();

    // document.getElementById('songTitle').textContent = `Title: ${firstTrack.name}`;

    document.getElementById('artistName').innerHTML = artistHTML;
    document.getElementById('artistImage').innerHTML = artistImageHTML;
  } catch (error) {
    console.error('Error searching for the song:', error);
  }
}

async function getSongInfo(songId) {
  try {
    const accessToken = 'BQCLz_O-XrrQJXO6lsaKKi13Xyo2WzQtqeeuqZBmo9HEzLd7vPdXKBM0QCy-GMKLKZf_N-3a-aNm68GGFCXehhR9vBWY0t7hV9JFW8iAgFUNVJFBLahanAelCpBZIs3m-Qtb63S6M7ZaRtMVNbVgdG3k6fGIXv7Hrl__rqoByANpu_520eJIxVuJV35UcZAU7BOprJZSlAWjAA-OaJNH22I';
    const songUrl = `https://api.spotify.com/v1/tracks/${songId}`;

    const response = await fetch(songUrl, {
      headers: {
        'Authorization': `Bearer ${accessToken}`
      }
    });

    if (!response.ok) {
      throw new Error('Failed to fetch song info');
    }

    const songData = await response.json();
    return songData;
  } catch (error) {
    console.error('Error fetching song info:', error);
    return null;
  }
}

// Usage:
const query = 'Suge';
searchSong(query)
  .then(songId => {
    if (songId) {
      console.log('Song ID:', songId);
      return getSongInfo(songId);
    } else {
      console.log('Song not found or error occurred');
    }
  })
  .then(songInfo => {
    if (songInfo) {
      console.log('Song info:', songInfo);
      // Optionally, extract and play the song's audio preview
      const audioPreviewUrl = songInfo.preview_url;
      if (audioPreviewUrl) {
        const audio = new Audio(audioPreviewUrl);
        audio.play();
      } else {
        console.log('No audio preview available');
      }
    } else {
      console.log('Failed to fetch song info');
    }
  });
</script>

</body>
</html>

